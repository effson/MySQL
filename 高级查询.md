## 1. 基础查询
### 全部查询
```SQL
SELECT * FROM table_name;
```
### 查询部分字段
```SQL
SELECT `field1`, `field2` FROM table_name;
```
### 别名
```SQL
SELECT `field1` AS 'NAME1', `field2` AS 'NAME2' FROM table_name;
```
### 去除重复记录
```SQL
SELECT distinct `field1` FROM table_name;
```
## 2. 条件查询
```SQL
SELECT * FROM `table_name` WHERE `field` = 'value';
```
```SQL
SELECT * FROM `table_name` WHERE `field1` = 'value1' AND `field2` = 'value2';
```
## 3. 范围查询
```SQL
SELECT * FROM `table_name` WHERE `field` BETWEEN range1 AND range2;
```
## 4. 判空查询
```SQL
SELECT * FROM `table_name` WHERE `column_name` IS NULL;
SELECT * FROM `table_name` WHERE `column_name` IS NOT NULL;
```
```SQL
SELECT * FROM `table_name` WHERE `column_name` = ''; # 为空字符串

SELECT * FROM `table_name` WHERE `column_name` <> ''; # 不为空字符串
SELECT * FROM `table_name` WHERE `column_name` != ''; # 不为空字符串
```
## 5. 模糊查询
```SQL
SELECT * FROM  `table_name` WHERE `name` LIKE 'abc%'; # 以 'abc' 开头
```
```SQL
SELECT * FROM  `table_name` WHERE `name` LIKE '%abc'; # 以 'abc' 结尾
```
```SQL
SELECT * FROM  `table_name` WHERE `name` LIKE '%abc%'; # 查询 name 包含 'abc'
```
```SQL
SELECT * FROM table_name WHERE name LIKE '_b%'; # 查询 name 第2个字符是 'b'
```

## 6. 分页查询
```SQL
SELECT column1, column2, ... FROM table_name
LIMIT offset, row_count;
```
- offset：偏移量（从第几条数据开始，0 表示第一条）
- row_count：要返回的行数

## 7. 查询后排序
```SQL
SELECT * FROM  `table_name` ORDER BY  `sort_column` ASC;
```
```SQL
SELECT * FROM  `table_name` ORDER BY  `sort_column1` ASC, `sort_column2` DESC;
```
## 8. 聚合查询
- COUNT()
- SUM()
- AVG()
- MAX()
- MIN()
## 9. 分组查询
```SQL
SELECT 分组列, 聚合函数(...) FROM  `表名`
[WHERE 条件]
GROUP BY 分组列
[HAVING 聚合条件]
[ORDER BY 排序列]
```
### 按部门分组统计员工数
```SQL
SELECT  `department_id`, COUNT(*) AS emp_count FROM `employees`
GROUP BY `department_id`;
```

### 按部门分组计算平均工资
```SQL
SELECT `department_id`, AVG(salary) AS avg_salary FROM `employees`
GROUP BY `department_id`;
```

### 多列分组（部门 + 职位）
```SQL
SELECT `department_id`, `job_id`, COUNT(*) AS emp_count FROM `employees`
GROUP BY `department_id`, `job_id`;
```

### 分组后再筛选（HAVING）
```SQL
SELECT `department_id`, COUNT(*) AS emp_count FROM employees
GROUP BY `department_id` HAVING emp_count > 5;
```
### 分组后排序
```SQL
SELECT `department_id`, COUNT(*) AS emp_count FROM `employees`
GROUP BY `department_id` ORDER BY emp_count DESC;
```

## 10. 联表查询
假设有两张表：<br>
employees(id, name, dept_id)<br>
departments(id, dept_name)<br>
### INNER JOIN 交集
```SQL
SELECT e.name, d.dept_name FROM employees e
INNER JOIN departments d ON e.dept_id = d.id;
```
### LEFT JOIN
取左表所有记录，右表无匹配则为 NULL
```SQL
SELECT e.name, d.dept_name FROM employees e
LEFT JOIN departments d ON e.dept_id = d.id;
```
### RIGHT JOIN
取右表所有记录，左表无匹配则为 NULL
```SQL
SELECT e.name, d.dept_name FROM employees e
RIGHT JOIN departments d ON e.dept_id = d.id;
```

### IN与连表查询的联系
```SQL
SELECT * FROM student WHERE class_id IN 
(SELECT cid FROM course WHERE teacher_id = 2);
```
可转化为：
```SQL
SELECT student.sid, student.gender, student.class_id,student.sname FROM student INNER JOIN course ON
student.class_id = course.cid WHERE teacher_id = 2;
```
## 11. 子查询/合并查询
### 单行子查询
```SQL
SELECT name, salary FROM employees
WHERE salary = (SELECT salary FROM employees WHERE employee_id = 12);
```
### 多行子查询
IN / NOT IN / ANY / ALL
```SQL
SELECT name, dept_id FROM employees
WHERE dept_id IN ( SELECT id FROM departments
    WHERE dept_name IN ('Sales', 'Finance')
); # 查询属于销售部或财务部的员工
```
```SQL
SELECT name, salary FROM employees
WHERE salary > ANY ( SELECT salary FROM employees
    WHERE dept_id = 2
); # 查询工资高于部门 2 任意一个人的员工
```
```SQL
SELECT name, salary FROM employees
WHERE salary > ALL ( SELECT salary FROM employees
    WHERE dept_id = 2
); # 查询工资高于部门 2 所有人的员工
```
## 高级查询练习
<img width="875" height="172" alt="image" src="https://github.com/user-attachments/assets/b487a15d-5d36-4fcd-b371-7e506d4e161d" />

### 查询平均成绩大于60分的同学的学号和平均成绩
```SQL
SELECT student_id, AVG(num) AS avg_num FROM score
GROUP BY student_id HAVING avg_num > 60; 
```
### 查询'C++高级架构'课程比'音视频'课程成绩高的所有学生的学号
```SQL
SELECT A.student_id FROM
(
(SELECT student_id, num FROM score WHERE course_id = (SELECT cid FROM course WHERE cname = 'C++高级架构')) AS A
INNER JOIN
(SELECT student_id, num FROM score WHERE course_id = (SELECT cid FROM course WHERE cname = '音视频')) AS B
ON A.student_id = B.student_id
)
WHERE A.num > B.num;
```
### 查询'C++高级架构'课程比'音视频'课程成绩高的所有学生的学号,如果只报了C++高级架构也满足条件
```SQL
SELECT A.student_id FROM
(
(SELECT student_id, num FROM score WHERE course_id = (SELECT cid FROM course WHERE cname = 'C++高级架构')) AS A
LEFT JOIN
(SELECT student_id, num FROM score WHERE course_id = (SELECT cid FROM course WHERE cname = '音视频')) AS B
ON A.student_id = B.student_id
)
WHERE A.num > IFNULL(B.num, 0);
```
### 查询所有同学的学号、姓名、选课数、总成绩
```SQL
SELECT sid, sname, A.course_num, A.total_num FROM
student LEFT JOIN
(
SELECT student_id, COUNT(course_id) AS course_num, SUM(num) as total_num
FROM score GROUP BY student_id
) AS A ON A.student_id = sid;
```
### 查询没学过‘谢小二’老师课的同学的学号、姓名
```SQL
SELECT sid, sname FROM
student WHERE sid NOT IN
(
SELECT DISTINCT student_id FROM
score WHERE course_id IN
(
SELECT cid FROM course
LEFT JOIN teacher ON course.teacher_id = teacher.tid WHERE teacher.name = '谢小二'
)
);
```
```SQL
SELECT sid, sname FROM
student LEFT JOIN
(
SELECT DISTINCT A.student_id FROM
(
(SELECT student_id, course_id FROM score) AS A
LEFT JOIN
(SELECT cid FROM course WHERE teacher_id =
(SELECT tid FROM teacher WHERE tname = '谢小二')
) AS B ON A.course_id = B.cid
WHERE B.cid IS NULL
) AS C ON student.sid = C.student_id;
```
### 查询学过课程编号为1并且也学过课程编号为2的同学的学号
分组：
```SQL
SELECT student_id FROM score WHERE course_id = 1 OR course_id = 2 GROUP BY student_id HAVING COUNT(course_id) > 2;
```
联表查询：
```SQL
SELECT A.student_id FROM
(
(SELECT student_id FROM score WHERE course_id = 1) AS A INNER JOIN
(SELECT student_id FROM score WHERE course_id = 2) AS B ON A.student_id = B.student_id
);
```
